# tuneport automated local import plan

## the problem
users want to click "add to spotify" for a youtube song that *doesn't* exist on spotify.
downloading the file works. adding it to a spotify playlist automatically is currently impossible via standard methods.

## failure analysis
we investigated every standard path. here is why they fail.

### 1. official spotify web api
**attempt:** `POST /playlists/{id}/tracks` with `spotify:local:...` uri.
**result:** 400 Bad Request.
**why:** spotify explicitly blocks adding local files via the web api. docs confirm this limitation is intentional. only cloud tracks can be added.

### 2. chrome extension file manipulation
**attempt:** have chrome extension write to a "watched" folder or manipulate spotify's db.
**result:** impossible.
**why:** chrome extensions are sandboxed. they cannot write arbitrary files (only downloads) and cannot see outside their sandbox to control other apps.

### 3. spotilocal (desktop bridge)
**attempt:** connect to `127.0.0.1:4370` (spotify's internal local server).
**result:** dead/locked down.
**why:** this "api" was never official. modern spotify versions heavily protect it with csrf/oauth tokens that are hard/impossible to generate from a third-party extension without triggering massive browser security warnings (mixed content) or being blocked entirely. also, it likely lacks "add to playlist" capability (was mostly for playback control).

### 4. desktop automation (applescript/autohotkey)
**attempt:** use os-level scripting.
**result:** requires native app.
**why:** browser extensions cannot execute os scripts.

## the solution: relay architecture
since we cannot push *in* to spotify from the browser, we need an agent *inside* spotify to pull data.

**spicetify** is that agent. it injects into the spotify desktop client, giving us access to internal apis that *can* manipulate local files.

### architecture
1.  **chrome extension (sender)**
    - downloads file to `Downloads/TunePort`.
    - sends signal: `{"file": "Artist - Title.mp3", "playlist": "spotify:playlist:..."}`
    - destination: relay server.

2.  **relay server (bridge)**
    - simple websocket/http server.
    - holds the signal.
    - authenticates clients via shared secret (generated by extension).

3.  **spicetify extension (receiver)**
    - runs inside spotify desktop.
    - connects to relay server.
    - on signal:
        1. scans "Local Files" (internal spotify index).
        2. matches filename.
        3. calls `Spicetify.Platform.PlaylistAPI.add()`.

### implementation steps

#### phase 1: relay server
- simple node.js websocket server.
- deployable to vercel/glitch/render.
- endpoints: `/connect` (ws), `/send` (http/ws).

#### phase 2: spicetify extension (`tuneport.js`)
- UI: adds a small connection status indicator in spotify.
- logic:
    - connects to relay.
    - listens for `add_track` events.
    - fuzzy matches filename against `Spicetify.LocalFiles.getTracks()`.
    - executes add command.

#### phase 3: chrome extension update
- add "TunePort Bridge" settings section.
- generate/display "Connection Key".
- update sync logic: if spotify match fails -> download -> send signal to bridge.

## user experience
1. install tuneport chrome extension.
2. install spicetify (if not present) + tuneport spicetify app.
3. enter connection key in spotify.
4. click "download" in chrome -> song appears in spotify playlist automatically.
